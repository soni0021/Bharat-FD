{"ast":null,"code":"var Delta, Document, PasteManager, Quill, dom, _;\nQuill = require('../quill');\nDocument = require('../core/document');\n_ = Quill.require('lodash');\ndom = Quill.require('dom');\nDelta = Quill.require('delta');\nPasteManager = function () {\n  function PasteManager(quill, options) {\n    this.quill = quill;\n    this.options = options;\n    this.container = this.quill.addContainer('paste-container');\n    this.container.setAttribute('contenteditable', true);\n    this.quill.addStyles({\n      '.paste-container': {\n        'left': '-10000px',\n        'position': 'absolute',\n        'top': '50%'\n      }\n    });\n    dom(this.quill.root).on('paste', _.bind(this._paste, this));\n  }\n  PasteManager.prototype._paste = function () {\n    var iframe, iframeScrollY, oldDocLength, range, windowScrollX, windowScrollY;\n    oldDocLength = this.quill.getLength();\n    range = this.quill.getSelection();\n    if (range == null) {\n      return;\n    }\n    this.container.innerHTML = \"\";\n    iframe = dom(this.quill.root).window();\n    iframeScrollY = iframe.scrollY;\n    windowScrollX = window.scrollX;\n    windowScrollY = window.scrollY;\n    this.container.focus();\n    return _.defer(function (_this) {\n      return function () {\n        var delta, doc, lengthAdded, line, lineBottom, offset, _ref;\n        doc = new Document(_this.container, _this.quill.options);\n        delta = doc.toDelta();\n        lengthAdded = delta.length() - 1;\n        delta.compose(new Delta().retain(lengthAdded)[\"delete\"](1));\n        if (range.start > 0) {\n          delta.ops.unshift({\n            retain: range.start\n          });\n        }\n        delta[\"delete\"](range.end - range.start);\n        _this.quill.updateContents(delta, 'user');\n        _this.quill.setSelection(range.start + lengthAdded, range.start + lengthAdded);\n        _ref = _this.quill.editor.doc.findLineAt(range.start + lengthAdded), line = _ref[0], offset = _ref[1];\n        lineBottom = line.node.offsetTop + line.node.offsetHeight;\n        if (lineBottom > iframeScrollY + _this.quill.root.offsetHeight) {\n          iframeScrollY = line.node.offsetTop - _this.quill.root.offsetHeight / 2;\n        }\n        iframe.scrollTo(0, iframeScrollY);\n        return window.scrollTo(windowScrollX, windowScrollY);\n      };\n    }(this));\n  };\n  return PasteManager;\n}();\nQuill.registerModule('paste-manager', PasteManager);\nmodule.exports = PasteManager;","map":null,"metadata":{},"sourceType":"script"}